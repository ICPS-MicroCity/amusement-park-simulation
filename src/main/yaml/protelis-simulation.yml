incarnation: protelis

# The network model used allows to choose the nodes that have the "cloud" molecule in order to simulate an access point behaviour
network-model:
  type: ConnectToAccessPoint
  parameters: [200.0, "activity"]

# Use an OpenStreetMap Environment, deploying nodes only on streets
environment:
  type: OSMEnvironment
  parameters: [mirabilandia.osm.pbf, true]

# Define the physical bounds of the park
_bounds: &bounds
  [[44.338, 12.26],[44.335, 12.263],[44.337, 12.268],[44.34, 12.266],[44.34, 12.264],[44.34, 12.262]]

# Define the movement law with a Walker that moves only on streets towards
# a GeoPosition indicated by the concentration of the "tracking" molecule
_move: &move
  - time-distribution: 1
    type: Event
    actions:
      - type: TargetMapWalker
        parameters: [org:protelis:microcity:towards, 1]

# Define the broadcast message from activities to guests
# to spread their positions
_positions: &positions
  - time-distribution: 1
    program: org:protelis:microcity:positions
  - program: send

# Define the rule that establishes how guests choose the
# next destination
_towards: &towards
  - time-distribution: 1
    program: org:protelis:microcity:towards
  - program: send

# Define the message that guests send when they get to
# an activity in order to enqueue themselves
_queue: &queue
  - time-distribution: 1
    program: org:protelis:microcity:queue
  - program: send

# Define the action of satisfying enqueued guests
_rounds: &rounds
  - time-distribution: 0.01
    program: org:protelis:microcity:rounds
  - program: send

_activityPrograms: &programs
  - *positions
  - *queue
  - *rounds

# Define guests
_guests: &guests
  - type: Polygon
    parameters: [ 20, *bounds ]
    programs:
      - *move
      - *towards
      - *positions
      - *queue
      - *rounds
    contents:
      - molecule: guest
        concentration: true
      - molecule: satisfied
        concentration: true
      - molecule: inQueue
        concentration: false
      - molecule: destination
        concentration: -1
      - molecule: org:protelis:microcity:positions
        concentration: []

# Define restaurants
_restaurants: &restaurants
  - type: Point
    parameters: [44.33747, 12.26208]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: restaurant
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [ 44.33815, 12.2633 ]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: restaurant
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [ 44.33682, 12.26425 ]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: restaurant
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [ 44.33589, 12.26293 ]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: restaurant
        concentration: true
      - molecule: roundCapacity
        concentration: 10

# Define attractions
_attractions: &attractions
  - type: Point
    parameters: [44.33691, 12.26136]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33908, 12.26462]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33852, 12.26238]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33719, 12.26472]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33793, 12.26698]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33831, 12.26194]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33698, 12.26281]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33539, 12.26133]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33734, 12.26611]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.3368, 12.2656]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10
  - type: Point
    parameters: [44.33779, 12.26401]
    programs: *programs
    contents:
      - molecule: activity
        concentration: true
      - molecule: attraction
        concentration: true
      - molecule: roundCapacity
        concentration: 10

# Deploy nodes
deployments:
  - *restaurants
  - *attractions
  - *guests
